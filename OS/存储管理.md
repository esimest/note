# 存储管理

## 存储管理的主要模式

### 逻辑地址

逻辑地址又称为相对地址, 用户编程所使用的地址空间

逻辑地址都是从 0 开始编号的, 有两种编址形式:

1. 一维逻辑地址

2. 二维逻辑地址(段号:段内地址号(从 0 开始))

### 物理地址

物理地址又称为绝对地址, 程序执行所使用的地址空间.

处理器执行指令时按照物理地址进行

### 主存储器的复用

多道程序同时执行时需要复用主存, 以下为两种复用的方式:

- 按分区复用
   > 主存划分成多个固定/可变尺寸的分区. 一个程序/程序段占用一个分区.

- 按页架复用
   > 主存划分成多个固定大小的页架. 一个程序/程序段占用多个页架.

### 主存储器管理基本模式(`逻辑地址 * 存储器复用方式`)

1. 单连续存储管理

2. 段式存储管理

3. 页式存储管理

4. 段页式存储管理

## 存储管理的功能

### 地址转换

地址转换又称为重定位, 即**把逻辑地址转换成绝对地址**.
地址转换有两种形式:

1. 静态重定位
   > 在程序装入内存时进行地址转换

2. 动态重定位(主流地址转换方式)
   > 在 CPU 执行程序时进行地址转换(依赖硬件实现)

### 主存分配与去配

- 分配
   > 进程转入主存时, 存储管理软件进行具体的主存分配操作,
   > 并设置一个表格记录主存空间的分配情况.

- 去配
   > 当进程撤离或主动归还主存资源时, 存储管理软件要收回它所占用的全部或部分存储空间,
   > 并调整主存分配表的信息.

### 主存共享

- 多个进程共享主存储器资源
   > 多道程序使用同一个主存储器

- 多个进程共享主存储器的某些区域
   > 若干个协作进程有共同的主存程序块或者主存数据块.

### 存储保护

存储保护需要硬件支持, 当 CPU 检查到访问不可访问的数据时则产生地址保护异常, 交给 OS 处理.
为避免主存中的多个进程相互干扰, 必须对主存中的程序和数据进行保护, 有以下策略:

- 私有主存区中的信息(自己的): 可读可写

- 公共区中的共享信息(大家的): 根据授权

- 非本进程信息(别人的): 不可读写

### 虚拟存储器

存储扩充:

   把磁盘作为主存的扩充, 只把部分进程或进程的部分内容装入内存.

- 对换技术
   > 把部分不运行的进程调出内存.

- 虚拟技术
   > 只调入进程的部分内容.

存储扩充功能需要硬件的支持:

1. 对换进程决定对换, 硬件机构调入;

2. CPU 处理到不在主存的地址, 发出虚拟地址异常, OS 将其调入, 重新执行.

## 虚拟存储

### 用户程序执行过程分析

1. 执行时有互斥性(不能同时执行);

2. 顺序性和循环性等空间局部特性;

3. 某一阶段执行的时间局部性;

由此可以考虑部分调入进程内容.

### 虚拟存储的基本思路

1. 存储管理器把进程全部信息放在辅存中, 执行时先将一部分装入主存, 以后根据执行行为随用随调入;

2. 如果主存没有猪狗的空闲空间, 存储管理需要根据执行行为把主存中暂时不用的信息调出到辅存上去;

### 虚拟存储的实现思路
