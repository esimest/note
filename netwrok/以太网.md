# 以太网

## 网络按作用范围分类

- 个人区域网
- 局域网
- 城域网
- 广域网

## 以太网（传输网络）

- 为什么叫以太
  > 网络的特征和古代以太理论很像
- 网络的特征
  > 用一种物理介质，将比特流传输到各个站点
- 以太理论
  > “以太”这种物质，通过电磁波充满了整个空间

### 总线型以太网

#### 物理层实现方法

- 基带传输
  1. 使用基带信号（幅度只有两种离散值的数字信号）实现数据传输的方式

- 曼切斯特编码

#### MAC层实现方法

- MAC地址（网卡地址，6字节48位）
  1. 单播地址：给某一台终端发送数据（MAC地址最后一位为0）
  2. 组播地址：给某一组终端发送数据（MAC地址最后一位为1）
  3. 广播地址：给所有MAC地址发送数据（MAC地址所有位都为1）

- MAC 帧格式
  1. 先导码(10101010,总共7字节)：让接收端可以进行位同步
  2. 帧开始分节符(10101011)：提示后面的内容为帧的实际内容
  3. 接收端MAC地址
  4. 发送端MAC地址
  5. VLAN标识（8100H vLAN_id）
  6. 数据类型（IP、ARP）
  7. 数据（46~1500字节）
     > 设置上限的原因：
     > 接收端缓存空间有限
     > 发送数据太长容易失败
     > 每个终端一次发送数据的时间不能太长
     > 设置下限的原因
     > 最短帧长 - 其它内容占据的长度
  8. 检错码（FCS）

- 帧对界
  1. 曼切斯特编码使得总线数据传输状态和空闲状态是不同的
  2. 两个帧之间至少存在段空闲时间，把属于不同帧的二进制位流分割开来

#### CSMA/CD(Carrie Sense Multiple Access With Collision Detection:载波侦听、多点接入和冲突检测）算法（使终端可以公平竞争总线）

> 载波侦听： 检测总线上是否有载波
> 多点接入： 可以有多个终端连接到总线上
> 冲突检测：检测总线上是否发生冲突

- 发送数据
  1. 先听后讲：判断总线是否空闲，如果空闲则进行第二步
  2. 等待一个时间段（帧间最小间隔）
  3. 边听边讲：发送数据时检测总线上是否发生冲突。发生冲突后发送一个阻塞信号，然后等--后退算法）
- 后退算法：
  1. 每个终端生成的延时时间都是随机的，且相互独立
  2. 最小时延时间最好是0，且只有一个为0
  3. 所有终端的平均延时时间尽可能的小
- 缺陷
  - 只适合轻负荷（不适合有大量终端的情况）
  - 存在捕获效应
    > 两个终端都想连续发送数据：一个长时间内一直竞争到总线发送数据。另一个长时间内直竞争不到总线发送数据
  - 存在最短帧长与冲突域直径之间的制约
    >冲突域直径：冲突域中两台最远的终端的距离为冲突域直径
    >如果冲突域直径为t, 终端A每一帧的长度必须大于等于2t
    > 最短帧长：2t时间内发送的帧长为64bytes，

#### 网桥分割冲突域

>解决CSMA/CD算法缺陷的思路
> 减少总线上的终端数量
> 缩小冲突域直径

### 网桥

>将大的以太网冲突域分割成多个小的冲突域，使每个小的冲突域终端数量减少，距离缩短。
>然后使用网桥设备将各冲突域相互连接
> *<font color=red>注：网桥的各个端口相当于总线上的终端，也要遵循CSMA/CD算法</font>*

#### 功能

1. 隔断电信号，使不同冲突域中的电信号互不干扰
2. 转发MAC帧（采用分组交换技术的分组转发设备），如果MAC帧的目的终端地址和源终端址在一个冲突域，则直接放弃分组不转发。
   > 网桥采用转发表来判断各终端地址与冲突域/网桥端口的对应关系
   > 网桥使得以太网从数据共享转变到数据交换 == 总线型以太网 --> 交换式以太网
   > *<font color=red>注：网桥无法分割广播域，网桥互联的多个冲突域属于一个广播</font>*

- 集线器(采取广播方式发送数据 == 总线型以太网)

### 交换式以太网（以交换机为分组交换设备构建的以太网称为交换式以太网）

#### 广播域

>广播：从某个端口接收到数据后，除这个端口以外其它端口都转发出去的转发过程
>广播域：以太网中所有的网桥都采用广播方式转发MAC帧，所能遍历的网络范围称为广播域。

- 广播的危害
  1. 浪费网络链路带宽、终端的处理能力
  2. 容易引发安全问题

> 网桥建立完整的转发表之前采用的是广播形式
> 大量的网络协议都是广播协议

- 解决广播危害思路
  1. 缩小广播域，将大的广播域划分成多个小的广播域

#### VLAN

> 划分物理以太网产生的每一个广播域等同于一个逻辑上独立的以太网，由于这些逻辑上独立以太网存在于同一个物理以太网中，因而被称为虚拟局域网(Virtual LAN)

- 特点
  1. 划分VLAN时：无需改变已有以太网的物理结构
  2. 改变VLAN时：无需改变已有的以太网结构
  3. 终端归属于哪个VLAN与终端在物理以太网中的位置无关。

##### 网桥与以太网交换机

- 网桥：具有地址学习、MAC帧准转等分组交换功能的设备
- 以太网交换机： 在网桥的基础上增加了划分VLAN以及其他一些增强网络性能的功能设备

##### 单交换机VLAN划分

1. 为VLAN分配端口
2. 建立端口之间交换路径
3. 确定MAC帧所属的VLAN
   > 默认情况下交换机的所有端口属于同一个VLAN/广播域
   > VLAN内部可以通信，VLAN之间不能联通

##### 多交换机VLAN划分

1. 端口配置原则
   - 允许：将属于不同交换机的多个端口分配到同一个VLAN
   - 保证：同一VLAN中任何两个端口之间都存在交换路径
2. 802.1Q协议
3. VLAN内MAC帧传输过程
4. 确定MAC帧所属VLAN
