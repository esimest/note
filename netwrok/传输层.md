### UDP
- UDP首部
  1. 源端口号（16位）
  2. 目的端口号（16位）
  3. 报文长度（16位）
  4. 检验和（16位）


### TCP
##### 特性
- 面向字节流
  1. 应用层提供字节流
  2. 传输层需要对数据进行拆分和组装

- 面向连接
  1. 数据传输之前收发两段之间需要协调过程
  2. 提供时序、可靠的传输服务

##### 功能
- 标识不同进程
- 差错控制
- 拥塞控制

##### TCP首部
- 源端口（16位）
- 目的端口（16位）
- 序号 ：数据中第一位在字节流中的位置
- 确认序号
- 首部长度
- 保留位（6位）
- 紧急位 URG，URG为1时，直接提交给应用层
- 确认位 ACK=1
- 推送位 PSH：紧急
- 释放连接 RST
- 同步位 SYN：用于建立连接
- 终止位 FIN：用于结束链接
- 窗口：接收端允许接收的的最大字节数
- 检验和（16位）
- 紧急指针（16位）：紧急处理的字节数


#### 建立连接 释放连接
- 建立连接
  1.  客户端发送连接请求： SYN=1 ACK=0 序号=x（用于和服务器确认客户端发送数据字节流的起始序号）
  2. 服务端响应连接请求：SYN=1 ACK=1 确认序号=x+1 序号=y（用于和客户端确认服务器发送数据字节流的起始序号）  窗口=WS（服务器开辟的用于存储客户端数据的缓存大小、既服务器一次性可接受数据的最大值）
  3. 客户端响应连接请求：SYN=0 ACK=1 窗口=WC（客户端预留给服务器请求的缓存大小） 确认序号=Y+1

- 释放连接（发起释放请求的既可以是客户端也可以是服务器）
  1. 发送端发送释放连接请求：FIN=1 ACK=1 序号=u（发送完成的数据的最后一个字节的序号+1）
  2. 接收端响应连接：FIN=0 确认序号=U+1 。并释放为发送端准备的资源
  3. 发送端接到响应后，释放资源，关闭整个连接


#### TCP差错控制机制   -- 检错 纠错
- 出错现象分析
  1. 错序
  2. 丢失
  3. 重复
  4. 报文出错，通过检验和检验出来后背丢弃
  5. 拥塞导致报文丢失

- 数据分段


- 确认应答
  1. 接收端收到正确的数据后，需要做出确认应答（即报文中的确认序号），如果收到错误报文，直接丢弃不做任何其他处理
  2. 发送端发送完数据后，将数据保留在本地，直到收到该数据的确认应答后才能删除
  3. TCP用确认序号给出接收端寂静成功接收的字节流
  4. 发送端在制定时间内接收不到确认应答，则会重发数据报文
  5. TCP采用连续ARQ传输机制

- 重传
  1. 发送端接收到4个相同的确认应答帧时，重传该序号对应的数据（常用于，少量数据丢失）
  2. 接收端超过指定时间（一般大于4个应答帧的时间）没有收到相应的应答帧时，重传该数据（常用于大量数据丢失）


#### TCP拥塞控制
> 拥塞是指分组交换机设备中经过某条链路的流量超出链路的传输能力，
> 使得输出队列中等待输出的报文越来越多，以至于发生输出队列溢出，报文丢弃

- 网络拥塞现象及原因



- TCP避免和消除拥塞的机制
> 网络传输TCP报文过程中发生报文丢失说明发生拥塞
> 报文丢失就需要重传，因此重传就需要哦调整发送端流量

> 流量控制依据的是接收端的处理能力和网络状态

> 接收端的处理能力可以通过确认应答中的窗口字段告知发送端
  - 慢启动状态（连接刚建立时，不知道网络承载能力时）

  - 拥塞避免状态