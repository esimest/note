# 报文

## MAC帧格式

1. 先导码(10101010,总共7字节)：让接收端可以进行位同步
2. 帧开始分界符(10101011)：提示后面的内容为帧的实际内容
3. 接收端MAC地址
4. 发送端MAC地址
5. VLAN标识（8100H vLAN_id）（不一定有）
6. 数据类型（IP、ARP）
7. 数据（46~1500字节）
   > 设置上限的原因
   > 接收端缓存空间有限
   > 发送数据太长容易失败
   > 每个终端一次发送数据的时间不能太长
   > 设置下限的原因
   > 最短帧长 - 其它内容占据的长度
8. 检错码（FCS）

## IP首部

1. 版本(4位)：IPv4：0100
2. 首部长度（4位）：以字节为单位，最小长度为5字节
3. 服务类型（8位：优先级3位 D T R 两位保留位）
   > 允许终端给网络提出提供服务的要求，如IP分组的优先级、延迟、吞吐率以及可靠性等，优先级范围为0~7，优先级越高就有限提供服务。D：延时要求 T：吞率要求  R：可靠性
4. 总长度（16位）：首部+数据的总长度。最大为65535字节
5. 标识（16位）：数据分片时，属于同于个数据片的标识值相同。便于重新组合
6. 标志（3位）：三位分别表示 DF MF 最后一位保留。若DF=1则IP分组不使用分片，MF为0表示为分片的最后一片。
7. 片偏移（13位）：表示数据片在原IP分组中的相对位置，单位为8字节
8. 生存时间（8位）：限制分组在网络中存在时间的计数器。目前该字段的值表示为最大跳。每经过一跳就减一。为0时丢弃分组
9. 协议（8位）：上层使用的协议类型
10. 首部检验和（16位）：对首部使用检验和计算出检错码，用于检验首部传输过程中是否发生错误
11. 源IP地址
12. 目的IP地址
    > IP分组固定部分用于保证IP分组端到端正确传输所需要的控制信息
    > 可选部分用于研究及特殊的用途
    > 由于可选部分有很强的侦察网络拓扑结构的能力，一般的路由器都屏蔽这些选项

## TCP首部

1. 源端口（16位）
2. 目的端口（16位）
3. 序号 ：数据中第一位在字节流中的位置
4. 确认序号
5. 首部长度
6. 保留位（6位）
7. 紧急位 URG，URG为1时，直接提交给应用层
8. 确认位 ACK=1
9. 推送位 PSH：紧急
10. 释放连接 RST
11. 同步位 SYN：用于建立连接
12. 终止位 FIN：用于结束链接
13. 窗口：接收端允许接收的的最大字节数
14. 检验和（16位）
15. 紧急指针（16位）：紧急处理的字节数

## UDP首部

1. 源端口号（16位）
2. 目的端口号（16位）
3. 报文长度（16位）
4. 检验和（16位）
