# 容器基本概念

## 操作系统管理进程的缺陷

- 操作系统中的进程可以相互感知，相互通信
   > 具备高级权限的进程可以攻击其他进程.

- 所有进程使用的是同一个文件系统(可以对同一个文件进行操作)
   > 不同进程之间的依赖可能会相互冲突.

- 使用相同的系统资源
   > 不同进程之间存在着资源抢占的问题.

## 上述操作系统管理进程缺陷的问题的解决方案

- 通过 NS 实现进程视图上的隔离(无法通信)

- 通过 chroot 将子目录变成进程的根目录, 是进程具备独立文件系统变成可能.

- 通过联合文件系统将多个镜像层的内容整合在一起形成一个单一的挂载点.

- 通过 cgroup 实现操作系硬件统资源使用的限制.

由于容器使用的是操作系统的硬件资源, 因此容器的文件系统不需要具备内核相关的代码或工具, 我们只需要提供容器所需要的二进制文件, 配置文件以及依赖即可. 只要容器运行时所需要的文件集合都能够具备, 那么这个容器就能够运行起来.

### 六种 NS

|  名称   |  隔离的资源                             |
| :----   |  :----                                  |
| IPC     |  信号量、消息队列、共享内存...           |
| Network |  网络设备、端口、IP...                   |
| Mount   |  文件系统挂载点(目录)(通过 chroot 实现)  |
| PID     |  进程号                                  |
| User    |  用户、用户组                            |
| UTS     |  主机名和 NIS 域名                       |
| cgroups |  硬件资源(cpu mem disk ...)              |

## 容器与镜像

容器:

   容器就是一个视图隔离, 资源可限制, 具备独立文件系统的进程集合.

镜像:

   容器运行时所需要的所有的文件集合称之为容器镜像.

容器镜像的分成以及服用特点能够带来以下几点优势:

1. 将大文件拆分成多个小文件可以提高镜像的分发效率(可以并行下载同一个镜像的不同层)

2. 只需要下载本地没有的镜像层;可以节约大量磁盘空间;

## 容器生命周期

容器的生命周期与 initial 进程的生命周期是一致的.

## 容器数据卷管理

```shell
# bind 宿主机目录
# 依赖宿主机环境
docker run -v /tmp:/tmp nginx:latest

# 容器卷交由容器引擎管理
docker create volume demo
docker run -v demp:/tmp nginx:latest

```

## 容器项目架构

## 容器存储驱动

存储驱动:

   一个支持一组特定能力的驱动(这组能力被抽象成接口可以在 Docker 引擎代码里找到) - 来将分层的镜像文件系统挂载到一个合并的根文件系统里面.

## 容器 & VM

### VM

- VM 通过模拟出计算机的硬件资源创建虚拟的计算机, 然后在虚拟的计算机上安装操作系统.
- 每一个虚拟的操作系统都需要一个完整的操作系统镜像(如 centos ubuntu windows...)

- 操作系统需要分配出一部分计算资源给到虚拟机管理系统使用.

- 每个 VM 启动过程都和真是计算机的启动过程是一样的(需要几分钟到十几分钟不等甚至更久)

- VM 可以提供一个更好的隔离级别.

### container

- 容器提供给进程运行所需要的运行时环境(只需要提供文件所需的运行时环境)

- 容器镜像文件不需要包含内核代码(和操作系统镜像相比要小很多)

- 容器是进程的集合因此启动速度很快(几秒到几十秒不等)

- 容器管理系统所占用的资源比虚拟机管理系统占用的资源要小得多

- 隔离级别不如 VM
